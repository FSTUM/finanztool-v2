{% extends 'base.html' %}
{% load bootstrap3 %}

{% block title %}{{ mahnung.wievielte }}. Mahnung zur RE {{ mahnung.rechnung.rnr_string }}{% endblock %}

{% block content %}
<h1>{{ mahnung.wievielte }}. Mahnung zur
    <a href="{% url "rechnung:rechnung" mahnung.rechnung.id %}">
        RE {{ mahnung.rechnung.rnr_string }} ({{ mahnung.rechnung.name }})
    </a>
</h1>
        {% if mahnung.geschickt and not mahnung.bezahlt and not rechnung.erledigt %}
            <form class=form-horizontal method="POST">{% csrf_token %}
                </br>
                <p>
                {{ form }}
                <button type="submit" name="bezahlt" class="save btn btn-success">
                    {% bootstrap_icon "ok" %} Bezahlt
                </button>
                </p>
            </form>
        {% elif not mahnung.geschickt and not mahnung.bezahlt and not rechnung.erledigt %}
            <form class=form-horizontal method="POST">{% csrf_token %}
                </br>
                <p>
                {{ form }}
                <button type="submit" name="geschickt" class="save btn btn-warning">
                    {% bootstrap_icon "envelope" %} Geschickt
                </button>
                </p>
            </form>
        {% endif %}

        {% if not rechnung.erledigt %}
        <a href="{% url "rechnung:mahnung_aendern" rechnung.id mahnung.id %}" class="btn btn-info" role="button">
            {% bootstrap_icon "pencil" %} Bearbeiten
        </a>
        {% endif %}

        <a href="{% url "rechnung:mahnungpdf" rechnung.id mahnung.id %}" class="btn btn-info" role="button">
            {% bootstrap_icon "download-alt" %} Herunterladen
        </a>


<br/>
<div class="row">
    <div class="col-md-12">
        <h3>Allgemein</h3>
        <br/>
        <table class="table" >
                <tr>
                    <th>Erledigt?</th>
                    <td>
                        {% if mahnung.bezahlt %}
                            {% bootstrap_icon "ok" %} Diese Mahnung wurde bezahlt.
                        {% else %}
                            {% if rechnung.erledigt %}
                                {% if rechnung.bezahlt %}
                                    {% bootstrap_icon "ok" %} Die Originalrechnung wurde bezahlt.
                                {% else %}
                                    {% bootstrap_icon "ok" %} Eine andere Mahnung wurde bezahlt.
                                {% endif %}
                            {% else %}
                                {% bootstrap_icon "remove" %} Es wurde noch keine zugehörige Mahnung bezahlt.
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>Kunde</th>
                    <td>
                       <a href="{% url 'rechnung:kunde' mahnung.rechnung.kunde.id %}">
                            {{ mahnung.rechnung.kunde }}
                        </a>
                    </td>
                </tr>
        </table>
    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <h3>Mahnung</h3>
        <br/>
        <table class="table table-striped" >
            <tr>
                <th>Erhobene Mahngebühr</th>
                <td align="right">{{ mahnung.gebuehr }} €</td>
            </tr>
            <tr>
                <th>Neue Bruttosumme:</th>
                <td align="right"><b>{{ mahnung.mahnsumme }} €<b></td>
            </tr>
            <tr>
                <th>Gerichtliche Schritte</th>
                <td>
                    {% if mahnung.gerichtlich %}
                        <span style="color : red;">wurden angedroht.</span>
                    {% else %}
                        {% bootstrap_icon "minus" %}
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Geschickt?</th>
                <td>
                    {% if mahnung.geschickt %}
                        {% bootstrap_icon "ok" %}
                    {% else %}
                        {% bootstrap_icon "remove" %}
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Datum</th>
                <td>{{ mahnung.mdatum }}</td>
            </tr>
            <tr>
                <th>Fälligkeitsdatum</th>
                <td>{{ mahnung.mfdatum }}</td>
            </tr>
            <tr>
                <th>Gestellt von</th>
                <td>{{ mahnung.ersteller.get_full_name }}</td>
            </tr>
            <tr>
            <tr>
                <th>Einleitungstext</th>
                <td>{{ mahnung.einleitung }}</td>
            </tr>
        </table>
    </div>
    <div class="col-md-6">
        <h3><a href="{% url 'rechnung:rechnung' rechnung.id %}">Original Rechnung</a></h3>
        <br/>
    <table class="table table-striped" >
            <tr>
                <th>Datum</th>
                <td>{{ mahnung.rechnung.rdatum }}</td>
            </tr>
            <tr>
                <th>Fälligkeitsdatum</th>
                <td>{{ mahnung.rechnung.fdatum }}</td>
            </tr>
            <tr>
                <th>Gestellt von</th>
                <td>{{ mahnung.rechnung.ersteller.get_full_name }}</td>
            </tr>
            <tr>
                <th>Einleitungstext</th>
                <td>{{ mahnung.rechnung.einleitung }}</td>
            </tr>
            <tr>
                <th>Gesamtsumme (brutto):</th>
                <td align="right"><b>{{ mahnung.rechnung.gesamtsumme }} €<b></td>
            </tr>
        </table>
    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <br/>
        <h3>Alle Mahnungen zur RE {{ mahnung.rechnung.rnr_string }}</h3>
        <br/>
        {% for m in rechnung.mahnungen %}
        <h4>
            <b>
                <a href="{% url 'rechnung:mahnung' m.rechnung.id m.id %}">
                    {{ m.wievielte }}. Mahnung
                </a>
            </b>
        </h4>
            <table class="table table-striped" >
                <tr>
                    <th>Mahngebühr {% bootstrap_icon "arrow-right" %} Neue Summe</th>
                    <td>{{ m.gebuehr }} € {% bootstrap_icon "arrow-right" %} <b> {{ m.mahnsumme }} €</b></td>
                </tr>
                <tr>
                    <th>Gerichtliche Schritte</th>
                    <td>
                    {% if m.gerichtlich %}
                        <span style="color : red;">wurden angedroht.</span>
                    {% else %}
                        {% bootstrap_icon "minus" %}
                    {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>Geschickt?</th>
                    <td>
                        {% if m.geschickt %}
                            {% bootstrap_icon "ok" %}
                        {% else %}
                            {% bootstrap_icon "remove" %}
                        {% endif %}
                        </td>
                <tr>
                    <th>Bezahlt?</th>
                    <td>
                        {% if m.bezahlt %}
                            {% bootstrap_icon "ok" %}
                        {% else %}
                            {% bootstrap_icon "remove" %}
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>Datum, Fällig</th>
                    <td>
                        {{ m.mdatum }}, 
                        {% if m.faellig and m.geschickt %}
                            <span style="color : red;">
                        {% else %}
                            <span>
                        {% endif %}
                        {{ m.mfdatum }}</span>
                    </td>
                </tr>
                <tr>
                    <th>Gestellt von</th>
                    <td>{{ m.ersteller.get_full_name }}</td>
                </tr>
                <tr>
                    <th>Einleitung</th>
                    <td>
                        {{ m.einleitung }}
                    </td>
                </tr>
            </table>
            <br/>
        {% endfor %}
    </div>
</div>

{% endblock %}
